#!/bin/bash

# Needed environment variables
# TMPDIR - directory for work directory
# MESA - main mesa directory
# ver - which compiler version (beginning with a period or blank)

date

echo mesa test 5 - dzp N2O SD CI
echo using version $ver

PATH=$PATH:$MESA/bin$ver
rundir=run_mesa_test_5$ver

cd $TMPDIR
rm -r $rundir
mkdir $rundir
cd $rundir
cp $MESA/mesa.dat .
mkdir tmp

siz=4000000

cat <<EOF | sed -e "s/#.*//" > mesacmn.inp 

\$geom
N1(basis=ePolyScat1)    0.00000000E+00   0.00000000E+00   0.00000000E+00
O1(basis=ePolyScat2)    0.00000000E+00   0.20767736E+01   0.88472676E+00
O2(basis=ePolyScat3)    0.00000000E+00  -0.20767736E+01   0.88472676E+00
\$end

\$ePolyScat1 N
type=s
   0.90460000E+04   0.70000003E-03
   0.13570000E+04   0.53890003E-02
   0.30930000E+03   0.27406001E-01
   0.87730000E+02   0.10320701E+00
   0.28560000E+02   0.27872301E+00
   0.10210000E+02   0.44854002E+00
   0.38380000E+01   0.27823801E+00
   0.74660000E+00   0.15440001E-01
   0.22480000E+00  -0.28640001E-02
type=s
   0.90460000E+04  -0.15299999E-03
   0.13570000E+04  -0.12079999E-02
   0.30930000E+03  -0.59919996E-02
   0.87730000E+02  -0.24543998E-01
   0.28560000E+02  -0.67458995E-01
   0.10210000E+02  -0.15807799E+00
   0.38380000E+01  -0.12183099E+00
   0.74660000E+00   0.54900296E+00
   0.22480000E+00   0.57881496E+00
type=s
   0.90460000E+04   0.00000000E+00
   0.13570000E+04   0.00000000E+00
   0.30930000E+03   0.00000000E+00
   0.87730000E+02   0.00000000E+00
   0.28560000E+02   0.00000000E+00
   0.10210000E+02   0.00000000E+00
   0.38380000E+01   0.00000000E+00
   0.74660000E+00   0.00000000E+00
   0.22480000E+00   0.10000000E+01
type=p
   0.13550000E+02   0.39919012E-01
   0.29170000E+01   0.21716907E+00
   0.79730000E+00   0.51031916E+00
   0.21850000E+00   0.46221414E+00
type=p
   0.13550000E+02   0.00000000E+00
   0.29170000E+01   0.00000000E+00
   0.79730000E+00   0.00000000E+00
   0.21850000E+00   0.10000000E+01
type=d
   0.81700000E+00   0.10000000E+01
\$end

\$ePolyScat2 O
type=s
   0.11720000E+05   0.71000025E-03
   0.17590000E+04   0.54700019E-02
   0.40080000E+03   0.27837010E-01
   0.11370000E+03   0.10480004E+00
   0.37030000E+02   0.28306210E+00
   0.13270000E+02   0.44871916E+00
   0.50250000E+01   0.27095210E+00
   0.10130000E+01   0.15458005E-01
   0.30230000E+00  -0.25850009E-02
type=s
   0.11720000E+05  -0.16000002E-03
   0.17590000E+04  -0.12630001E-02
   0.40080000E+03  -0.62670006E-02
   0.11370000E+03  -0.25716002E-01
   0.37030000E+02  -0.70924007E-01
   0.13270000E+02  -0.16541102E+00
   0.50250000E+01  -0.11695501E+00
   0.10130000E+01   0.55736805E+00
   0.30230000E+00   0.57275906E+00
type=s
   0.11720000E+05   0.00000000E+00
   0.17590000E+04   0.00000000E+00
   0.40080000E+03   0.00000000E+00
   0.11370000E+03   0.00000000E+00
   0.37030000E+02   0.00000000E+00
   0.13270000E+02   0.00000000E+00
   0.50250000E+01   0.00000000E+00
   0.10130000E+01   0.00000000E+00
   0.30230000E+00   0.10000000E+01
type=p
   0.17700000E+02   0.43017992E-01
   0.38540000E+01   0.22891296E+00
   0.10460000E+01   0.50872791E+00
   0.27530000E+00   0.46053092E+00
type=p
   0.17700000E+02   0.00000000E+00
   0.38540000E+01   0.00000000E+00
   0.10460000E+01   0.00000000E+00
   0.27530000E+00   0.10000000E+01
type=d
   0.11850000E+01   0.10000000E+01
\$end

\$ePolyScat3 O
type=s
   0.11720000E+05   0.71000025E-03
   0.17590000E+04   0.54700019E-02
   0.40080000E+03   0.27837010E-01
   0.11370000E+03   0.10480004E+00
   0.37030000E+02   0.28306210E+00
   0.13270000E+02   0.44871916E+00
   0.50250000E+01   0.27095210E+00
   0.10130000E+01   0.15458005E-01
   0.30230000E+00  -0.25850009E-02
type=s
   0.11720000E+05  -0.16000002E-03
   0.17590000E+04  -0.12630001E-02
   0.40080000E+03  -0.62670006E-02
   0.11370000E+03  -0.25716002E-01
   0.37030000E+02  -0.70924007E-01
   0.13270000E+02  -0.16541102E+00
   0.50250000E+01  -0.11695501E+00
   0.10130000E+01   0.55736805E+00
   0.30230000E+00   0.57275906E+00
type=s
   0.11720000E+05   0.00000000E+00
   0.17590000E+04   0.00000000E+00
   0.40080000E+03   0.00000000E+00
   0.11370000E+03   0.00000000E+00
   0.37030000E+02   0.00000000E+00
   0.13270000E+02   0.00000000E+00
   0.50250000E+01   0.00000000E+00
   0.10130000E+01   0.00000000E+00
   0.30230000E+00   0.10000000E+01
type=p
   0.17700000E+02   0.43017992E-01
   0.38540000E+01   0.22891296E+00
   0.10460000E+01   0.50872791E+00
   0.27530000E+00   0.46053092E+00
type=p
   0.17700000E+02   0.00000000E+00
   0.38540000E+01   0.00000000E+00
   0.10460000E+01   0.00000000E+00
   0.27530000E+00   0.10000000E+01
type=d
   0.11850000E+01   0.10000000E+01
\$end
EOF
cat <<EOF | sed -e "s/#.*//" > mesa.inp 
\$title
vdzp NO2 scf
\$end

\$route
sym=norotate
maxsiz=900000
2s+1=2
hf scf=(pulay)
guess=(core)
sym=off
geom=(inau,coord)
\$end
EOF
cat <mesacmn.inp >>mesa.inp
optmesa siz=$siz
mv mesa.out out.scf
cat out.scf
mv mesa.inp inp.scf

cat <<EOF | sed -e "s/#.*//" > mesa.inp 
\$title
vdzp NO2 SD CI
\$end

\$route
maxsiz=1300000
2s+1=2
ci
guess=(chk) 
sym=off 
geom=(inau,coord)
drt=(vexcite=2,refexcite=99)
\$end

\$drt
3cor1 8doc1 1alp1 33uoc1
\$end

EOF
cat <mesacmn.inp >> mesa.inp
optmesa siz=$siz
mv mesa.out out.ci
mv mesa.inp inp.ci
cat out.ci

date

